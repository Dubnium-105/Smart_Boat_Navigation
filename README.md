# Smart Boat Navigation 智能船舶导航系统

![项目状态](https://img.shields.io/badge/状态-开发中-brightgreen)
![版本](https://img.shields.io/badge/版本-0.5.0-blue)
![平台](https://img.shields.io/badge/平台-ESP32S3-orange)

## 项目简介

Smart Boat Navigation 是一个基于ESP32的智能船舶自主导航系统，通过整合视觉系统和红外传感器实现目标检测与自主导航功能。该项目使用PlatformIO进行开发，包含多个功能分支以实现不同的导航模式和感知能力。

## 技术栈

- **硬件平台**: ESP32-S3-CAM
- **开发环境**: PlatformIO，Visual Studio Code，Arduion
- **编程语言**: C++，Python
- **通信协议**: TCP/IP，MQTT
- **传感器系统**: 
  - 摄像头模块(OV2640)
  - 红外传感器阵列(MCP23017扩展)
  - MPU6050陀螺仪和加速度计
- **用户界面**: Python+Tkinter
- **电机控制**: PWM双电机控制

## 系统架构

```
+-----------------+      +------------------+
| 传感器子系统      |      | 控制子系统        |
|  - 摄像头模块    | ---> |  - TCP/IP服务器   |
|  - 红外传感器阵列 | ---> |  - MQTT客户端     |
|  - MPU6050      | ---> |  - 电机控制PWM    |
+-----------------+      +------------------+
         ^                         |
         |                         v
+-------------------+     +-------------------+
| 导航算法           |     | Python客户端界面    |
|  - 目标检测        | <-- |  - 实时视频显示     |
|  - 路径规划        |     |  - 传感器数据可视化  |
|  - 障碍物避免      |     |  - 手动/自动控制     |
+-------------------+     +-------------------+
```

## 分支说明与进度

### 1. 主分支 (main)

**功能**：系统核心框架，包含基本的WiFi连接、电机控制和通信协议。

**当前状态**：稳定，可作为其他分支的基础。

**主要特点**：
- WiFi自动连接多个预设网络
- TCP服务器实现远程控制
- 基本的电机控制功能
- JSON格式的数据交换

### 2. 摄像头开发分支 (Cam-dev-new)

**功能**：基于ESP32-S3-CAM的视觉导航系统。

**当前状态**：开发中，基本功能已实现。

**主要特点**：
- 实时视频流传输(TCP端口5001)
- 目标亮点检测算法
- 低延迟图像处理
- 视觉数据分析和处理
- 支持多种图像尺寸和质量设置

**开发进度**：
- [x] 摄像头初始化和配置
- [x] TCP图像传输协议
- [x] 亮点检测算法
- [x] Python客户端显示
- [ ] 基于视觉的自主导航

### 3. 红外传感器分支 (ir-sensor)

**功能**：基于红外传感器阵列的障碍物感知和导航系统。

**当前状态**：功能完整，正在优化算法。

**主要特点**：
- 16个红外传感器均匀分布(360度感知)
- 利用MCP23017 I2C扩展模块控制传感器
- 通过MQTT进行数据传输
- 矢量场算法计算导航方向
- 目标跟踪和避障融合算法

**开发进度**：
- [x] 红外传感器阵列驱动
- [x] MCP23017扩展器集成
- [x] 方向矢量计算
- [x] MQTT通信实现
- [x] 可视化界面开发
- [x] 自动导航控制

## 硬件连接

### ESP32-CAM 连接

| ESP32-CAM 引脚 | 功能           | 连接目标          |
|---------------|---------------|-----------------|
| 15            | XCLK          | 摄像头时钟        |
| 4, 5          | SDA, SCL      | 摄像头I2C        |
| 16-9          | Y9-Y2         | 摄像头数据线      |
| 6, 7, 13      | VSYNC, HREF, PCLK | 摄像头同步     |
| 38, 39        | MOTOR_A       | 左电机控制       |
| 40, 41        | MOTOR_B       | 右电机控制       |

### ESP32+红外传感器连接

| ESP32 引脚    | 功能           | 连接目标          |
|--------------|---------------|-----------------|
| 19, 20       | SDA, SCL      | MPU6050        |
| 21, 47       | SDA, SCL      | MCP23017       |
| 38, 39       | MOTOR_A       | 左电机控制       |
| 40, 41       | MOTOR_B       | 右电机控制       |

## 通信协议

### TCP通信

- **控制端口**: 5000
- **图像端口**: 5001

#### 控制命令格式：
```
PING                       # 心跳检测 -> 返回PONG
MOTOR,[left],[right]       # 电机控制，参数范围-100到100
```

#### 图像数据格式:
图像数据通过二进制方式发送，先发送4字节的长度信息，然后发送JPEG数据

### MQTT通信 (红外分支)

- **Broker**: emqx.link2you.top:1883
- **主题**:
  - `/sensor/data`: 传感器数据
  - `/motor`: 电机控制命令
  - `/ESP32_info`: 设备信息
  - `/motor/status`: 电机状态

## 控制界面

### 摄像头分支控制界面
- TCP连接管理
- 实时视频显示
- 摄像头参数调整
- 设备状态监控

### 红外分支控制界面
- MQTT连接管理
- 红外传感器可视化
- 电机速度控制
- 目标方向和强度显示
- 自动/手动控制模式切换

## 自主导航算法

### 视觉导航 (摄像头分支)
1. 捕获图像
2. 寻找图像中最亮的点
3. 计算亮点相对于中心的偏移
4. 根据偏移调整电机速度实现转向

### 红外导航 (红外分支)
1. 读取16个红外传感器状态
2. 将激活的传感器方向矢量合成为目标方向
3. 计算目标角度和强度
4. 根据目标角度调整电机差速实现转向

## 安装和运行

### 固件编译和上传

1. 安装PlatformIO
2. 克隆仓库：`git clone <仓库地址>`
3. 切换到需要的分支：`git checkout <分支名>`
4. 连接ESP32设备
5. 编译并上传：`pio run -t upload`

### 控制软件运行

1. 安装Python 3.8+
2. 安装依赖：`pip install -r requirements.txt`
3. 运行控制程序：`python control.py`

## 后续开发计划

1. **融合分支**: 整合摄像头和红外传感器分支，实现多模态感知
2. **导航算法优化**: 实现更高效的路径规划和动态避障
3. **Web界面**: 开发基于Web的控制界面，支持移动设备
4. **数据记录与分析**: 添加数据记录功能，支持航行数据分析
5. **GPS集成**: 添加GPS模块，实现定位功能



## 许可证

MIT License
